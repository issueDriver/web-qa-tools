<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cURLå‘½ä»¤ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #e0f2f7 0%, #d4e8f0 50%, #c8e0ea 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2em;
            color: #333;
            margin-bottom: 10px;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #4a90e2;
            text-decoration: none;
            font-size: 0.9em;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        input[type="text"],
        input[type="url"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #4a90e2;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .headers-container {
            margin-top: 10px;
        }

        .header-item {
            display: grid;
            grid-template-columns: 1fr 2fr auto;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .header-item input {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .btn {
            padding: 10px 20px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #3a7bc8;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .result-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .result-section.active {
            display: block;
        }

        .result-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .curl-output {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
            margin-bottom: 15px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #4a90e2;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #666;
        }

        .info-box strong {
            color: #333;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #856404;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .header-item {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <div class="header">
            <h1>ğŸ”§ cURLå‘½ä»¤ç”Ÿæˆå™¨</h1>
        </div>

        <div class="form-section">
            <div class="section-title">å¿«é€Ÿå¯¼å…¥ï¼ˆç²˜è´´åŸå§‹è¯·æ±‚æ–‡æœ¬ï¼‰</div>
            <div class="form-group">
                <label for="rawInput">ç²˜è´´è¯·æ±‚ä¿¡æ¯ï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼‰ï¼š</label>
                <textarea id="rawInput" placeholder="ç²˜è´´åŒ…å«URLã€Headersã€Bodyçš„è¯·æ±‚ä¿¡æ¯ï¼Œå·¥å…·ä¼šè‡ªåŠ¨è§£æ..." style="min-height: 150px;"></textarea>
            </div>
            <button class="btn btn-success" onclick="parseRawInput()">è§£æå¹¶å¡«å……</button>
        </div>

        <div class="form-section">
            <div class="section-title">è¯·æ±‚åŸºæœ¬ä¿¡æ¯</div>
            <div class="form-group">
                <label for="method">è¯·æ±‚æ–¹æ³•ï¼š</label>
                <select id="method">
                    <option value="GET">GET</option>
                    <option value="POST" selected>POST</option>
                    <option value="PUT">PUT</option>
                    <option value="DELETE">DELETE</option>
                    <option value="PATCH">PATCH</option>
                    <option value="HEAD">HEAD</option>
                    <option value="OPTIONS">OPTIONS</option>
                </select>
            </div>
            <div class="form-group">
                <label for="url">è¯·æ±‚URLï¼š</label>
                <input type="url" id="url" placeholder="https://example.com/api/endpoint">
            </div>
        </div>

        <div class="form-section">
            <div class="section-title">è¯·æ±‚å¤´ (Headers)</div>
            <div class="headers-container" id="headersContainer">
                <div class="header-item">
                    <input type="text" placeholder="Headeråç§°" class="header-key" value="Content-Type">
                    <input type="text" placeholder="Headerå€¼" class="header-value" value="application/json;charset=UTF-8">
                    <button class="btn btn-danger btn-small" onclick="removeHeader(this)">åˆ é™¤</button>
                </div>
            </div>
            <button class="btn btn-secondary" onclick="addHeader()">æ·»åŠ Header</button>
        </div>

        <div class="form-section">
            <div class="section-title">è¯·æ±‚ä½“ (Body)</div>
            <div class="form-group">
                <label for="body">JSON Bodyï¼ˆä»…POST/PUT/PATCHéœ€è¦ï¼‰ï¼š</label>
                <textarea id="body" placeholder='{"key": "value"}'></textarea>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn" onclick="generateCurl()">ç”ŸæˆcURLå‘½ä»¤</button>
            <button class="btn btn-secondary" onclick="clearAll()">æ¸…ç©ºæ‰€æœ‰</button>
            <button class="btn btn-secondary" onclick="loadExample()">åŠ è½½ç¤ºä¾‹</button>
        </div>

        <div class="result-section" id="resultSection">
            <div class="result-title">ç”Ÿæˆçš„cURLå‘½ä»¤ï¼š</div>
            <div class="curl-output" id="curlOutput"></div>
            <div class="btn-group">
                <button class="btn" onclick="copyCurl()">å¤åˆ¶å‘½ä»¤</button>
                <button class="btn btn-secondary" onclick="copyAsBash()">å¤åˆ¶ä¸ºBashè„šæœ¬</button>
            </div>
        </div>

        <div class="warning-box">
            <strong>âš ï¸ å®‰å…¨æç¤ºï¼š</strong><br>
            â€¢ æœ¬å·¥å…·ä¸ä¼šä¿å­˜æˆ–ç¼“å­˜ä»»ä½•è¾“å…¥çš„ä¿¡æ¯<br>
            â€¢ æ‰€æœ‰æ•°æ®ä»…åœ¨æµè§ˆå™¨æœ¬åœ°å¤„ç†ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨<br>
            â€¢ è¯·å¦¥å–„ä¿ç®¡ç”Ÿæˆçš„cURLå‘½ä»¤ï¼Œé¿å…æ³„éœ²æ•æ„Ÿä¿¡æ¯<br>
            â€¢ ä½¿ç”¨å®Œæ¯•åå»ºè®®æ¸…ç©ºæ‰€æœ‰è¾“å…¥
        </div>

        <div class="info-box">
            <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
            â€¢ è¾“å…¥è¯·æ±‚æ–¹æ³•ã€URLå’ŒHeaders<br>
            â€¢ å¯¹äºPOST/PUT/PATCHè¯·æ±‚ï¼Œå¯ä»¥è¾“å…¥JSONæ ¼å¼çš„Body<br>
            â€¢ ç‚¹å‡»"ç”ŸæˆcURLå‘½ä»¤"ç”Ÿæˆå¯¹åº”çš„curlå‘½ä»¤<br>
            â€¢ å¯ä»¥å¤åˆ¶å‘½ä»¤ç›´æ¥åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨<br>
            â€¢ æ”¯æŒæ·»åŠ å¤šä¸ªè‡ªå®šä¹‰Headers
        </div>
    </div>

    <script>
        // æ·»åŠ Headerè¡Œ
        function addHeader() {
            const container = document.getElementById('headersContainer');
            const item = document.createElement('div');
            item.className = 'header-item';
            item.innerHTML = `
                <input type="text" placeholder="Headeråç§°" class="header-key">
                <input type="text" placeholder="Headerå€¼" class="header-value">
                <button class="btn btn-danger btn-small" onclick="removeHeader(this)">åˆ é™¤</button>
            `;
            container.appendChild(item);
        }

        // åˆ é™¤Headerè¡Œ
        function removeHeader(btn) {
            const container = document.getElementById('headersContainer');
            if (container.children.length > 1) {
                btn.parentElement.remove();
            } else {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªHeaderè¡Œ');
            }
        }

        // è·å–æ‰€æœ‰Headers
        function getHeaders() {
            const headers = {};
            const items = document.querySelectorAll('.header-item');
            items.forEach(item => {
                const key = item.querySelector('.header-key').value.trim();
                const value = item.querySelector('.header-value').value.trim();
                if (key && value) {
                    headers[key] = value;
                }
            });
            return headers;
        }

        // ç”ŸæˆcURLå‘½ä»¤
        function generateCurl() {
            const method = document.getElementById('method').value;
            const url = document.getElementById('url').value.trim();
            const body = document.getElementById('body').value.trim();
            const headers = getHeaders();

            if (!url) {
                alert('è¯·è¾“å…¥URL');
                return;
            }

            let curlCommand = 'curl -X ' + method;

            // æ·»åŠ Headers
            Object.keys(headers).forEach(key => {
                const value = headers[key];
                // è½¬ä¹‰å•å¼•å·å’Œç‰¹æ®Šå­—ç¬¦
                const escapedValue = value.replace(/'/g, "'\\''");
                curlCommand += ` \\\n  -H '${key}: ${escapedValue}'`;
            });

            // æ·»åŠ Bodyï¼ˆä»…POST/PUT/PATCHï¼‰
            if (body && ['POST', 'PUT', 'PATCH'].includes(method)) {
                // è½¬ä¹‰JSONä¸­çš„ç‰¹æ®Šå­—ç¬¦
                const escapedBody = body.replace(/'/g, "'\\''");
                curlCommand += ` \\\n  -d '${escapedBody}'`;
            }

            // æ·»åŠ URL
            curlCommand += ` \\\n  '${url}'`;

            // æ˜¾ç¤ºç»“æœ
            document.getElementById('curlOutput').textContent = curlCommand;
            document.getElementById('resultSection').classList.add('active');
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // å¤åˆ¶cURLå‘½ä»¤
        function copyCurl() {
            const curlCommand = document.getElementById('curlOutput').textContent;
            if (!curlCommand) {
                alert('è¯·å…ˆç”ŸæˆcURLå‘½ä»¤');
                return;
            }

            navigator.clipboard.writeText(curlCommand).then(() => {
                alert('âœ“ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(() => {
                // é™çº§æ–¹æ¡ˆ
                const textarea = document.createElement('textarea');
                textarea.value = curlCommand;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    alert('âœ“ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                } catch (err) {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                }
                document.body.removeChild(textarea);
            });
        }

        // å¤åˆ¶ä¸ºBashè„šæœ¬
        function copyAsBash() {
            const curlCommand = document.getElementById('curlOutput').textContent;
            if (!curlCommand) {
                alert('è¯·å…ˆç”ŸæˆcURLå‘½ä»¤');
                return;
            }

            const bashScript = `#!/bin/bash\n\n${curlCommand}\n`;
            
            navigator.clipboard.writeText(bashScript).then(() => {
                alert('âœ“ Bashè„šæœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = bashScript;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    alert('âœ“ Bashè„šæœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                } catch (err) {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                }
                document.body.removeChild(textarea);
            });
        }

        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è¾“å…¥å—ï¼Ÿ')) {
                document.getElementById('rawInput').value = '';
                document.getElementById('method').value = 'POST';
                document.getElementById('url').value = '';
                document.getElementById('body').value = '';
                
                // é‡ç½®Headers
                const container = document.getElementById('headersContainer');
                container.innerHTML = `
                    <div class="header-item">
                        <input type="text" placeholder="Headeråç§°" class="header-key" value="Content-Type">
                        <input type="text" placeholder="Headerå€¼" class="header-value" value="application/json;charset=UTF-8">
                        <button class="btn btn-danger btn-small" onclick="removeHeader(this)">åˆ é™¤</button>
                    </div>
                `;
                
                document.getElementById('resultSection').classList.remove('active');
            }
        }

        // åŠ è½½ç¤ºä¾‹ï¼ˆä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰
        function loadExample() {
            if (confirm('åŠ è½½ç¤ºä¾‹ä¼šè¦†ç›–å½“å‰è¾“å…¥ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ')) {
                document.getElementById('method').value = 'POST';
                document.getElementById('url').value = 'https://example.com/api/endpoint';
                document.getElementById('body').value = JSON.stringify({
                    "key": "value",
                    "id": 123
                }, null, 2);
                
                // è®¾ç½®ç¤ºä¾‹Headers
                const container = document.getElementById('headersContainer');
                container.innerHTML = `
                    <div class="header-item">
                        <input type="text" placeholder="Headeråç§°" class="header-key" value="Content-Type">
                        <input type="text" placeholder="Headerå€¼" class="header-value" value="application/json;charset=UTF-8">
                        <button class="btn btn-danger btn-small" onclick="removeHeader(this)">åˆ é™¤</button>
                    </div>
                    <div class="header-item">
                        <input type="text" placeholder="Headeråç§°" class="header-key" value="Authorization">
                        <input type="text" placeholder="Headerå€¼" class="header-value" value="Bearer token">
                        <button class="btn btn-danger btn-small" onclick="removeHeader(this)">åˆ é™¤</button>
                    </div>
                `;
            }
        }

        // è§£æåŸå§‹è¾“å…¥æ–‡æœ¬
        function parseRawInput() {
            const rawText = document.getElementById('rawInput').value.trim();
            
            if (!rawText) {
                alert('è¯·å…ˆç²˜è´´è¯·æ±‚ä¿¡æ¯');
                return;
            }

            try {
                // è§£æè¯·æ±‚æ–¹æ³•
                const methodMatch = rawText.match(/(?:å‘é€è¯·æ±‚|Request Method|Method|è¯·æ±‚æ–¹æ³•)[:\s]+(GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS)/i);
                if (methodMatch) {
                    document.getElementById('method').value = methodMatch[1].toUpperCase();
                }

                // è§£æURL
                const urlMatch = rawText.match(/(?:URL|url|è¯·æ±‚åœ°å€)[:\s]+(https?:\/\/[^\s\n]+)/i) || 
                                 rawText.match(/(https?:\/\/[^\s\n]+)/);
                if (urlMatch) {
                    document.getElementById('url').value = urlMatch[1].trim();
                }

                // è§£æHeaders - æŸ¥æ‰¾Headerséƒ¨åˆ†
                let headersText = '';
                const headersSectionMatch = rawText.match(/(?:Headers|è¯·æ±‚å¤´|è¯·æ±‚å¤´ä¿¡æ¯)[:\s]*\n([\s\S]*?)(?:\n\n|\nBody|$)/i);
                
                if (headersSectionMatch) {
                    headersText = headersSectionMatch[1];
                } else {
                    // å¦‚æœæ²¡æœ‰æ˜ç¡®çš„Headersæ ‡è®°ï¼ŒæŸ¥æ‰¾URLå’ŒBodyä¹‹é—´çš„å†…å®¹
                    const urlEndMatch = rawText.match(/https?:\/\/[^\s\n]+/);
                    const bodyStartMatch = rawText.match(/(?:Body|è¯·æ±‚ä½“)[:\s]*/i);
                    
                    if (urlEndMatch && bodyStartMatch) {
                        const urlEndIndex = urlEndMatch.index + urlEndMatch[0].length;
                        const bodyStartIndex = bodyStartMatch.index;
                        if (bodyStartIndex > urlEndIndex) {
                            headersText = rawText.substring(urlEndIndex, bodyStartIndex);
                        }
                    }
                }

                // è§£æHeadersè¡Œ
                const container = document.getElementById('headersContainer');
                container.innerHTML = '';
                
                const allLines = headersText ? headersText.split('\n') : rawText.split('\n');
                const headerKeys = new Set(); // é¿å…é‡å¤
                
                allLines.forEach(line => {
                    const trimmed = line.trim();
                    if (!trimmed) return;
                    
                    // è·³è¿‡éHeaderè¡Œ
                    if (trimmed.match(/^(account|content|æ—¶é—´|å‘é€è¯·æ±‚|URL|Headers|Body|Request Method|Method)/i)) {
                        return;
                    }
                    
                    // åŒ¹é…Headeræ ¼å¼: Key: Value æˆ– Key:Value
                    const headerMatch = trimmed.match(/^([^:]+?)[:\s]+(.+)$/);
                    if (headerMatch) {
                        const key = headerMatch[1].trim();
                        const value = headerMatch[2].trim();
                        
                        // è¿‡æ»¤æ‰æ˜æ˜¾ä¸æ˜¯Headerçš„å†…å®¹
                        if (key && value && 
                            !key.match(/^(account|content|æ—¶é—´|å‘é€è¯·æ±‚|URL|Body|https?)/i) &&
                            !value.match(/^https?:\/\//) &&
                            !headerKeys.has(key.toLowerCase())) {
                            
                            headerKeys.add(key.toLowerCase());
                            
                            const item = document.createElement('div');
                            item.className = 'header-item';
                            item.innerHTML = `
                                <input type="text" placeholder="Headeråç§°" class="header-key" value="${escapeHtml(key)}">
                                <input type="text" placeholder="Headerå€¼" class="header-value" value="${escapeHtml(value)}">
                                <button class="btn btn-danger btn-small" onclick="removeHeader(this)">åˆ é™¤</button>
                            `;
                            container.appendChild(item);
                        }
                    }
                });
                
                // å¦‚æœæ²¡æœ‰è§£æåˆ°headersï¼Œè‡³å°‘ä¿ç•™ä¸€ä¸ªé»˜è®¤çš„
                if (container.children.length === 0) {
                    addHeader();
                }

                // è§£æBody - æ”¯æŒå¤šç§æ ¼å¼
                let bodyText = '';
                const bodySectionMatch = rawText.match(/(?:Body|è¯·æ±‚ä½“|è¯·æ±‚å†…å®¹)[:\s]*\n?([\s\S]*?)(?:\n\n|$)/i);
                
                if (bodySectionMatch) {
                    bodyText = bodySectionMatch[1].trim();
                } else {
                    // å°è¯•æŸ¥æ‰¾JSONå¯¹è±¡
                    const jsonMatch = rawText.match(/(\{[\s\S]*\})/);
                    if (jsonMatch) {
                        bodyText = jsonMatch[1].trim();
                    }
                }
                
                if (bodyText) {
                    // å°è¯•æ ¼å¼åŒ–JSON
                    try {
                        const jsonObj = JSON.parse(bodyText);
                        document.getElementById('body').value = JSON.stringify(jsonObj, null, 2);
                    } catch (e) {
                        // å¦‚æœä¸æ˜¯æœ‰æ•ˆJSONï¼Œç›´æ¥ä½¿ç”¨åŸæ–‡æœ¬
                        document.getElementById('body').value = bodyText;
                    }
                }

                alert('âœ“ è§£æå®Œæˆï¼è¯·æ£€æŸ¥å¹¶è°ƒæ•´åç”ŸæˆcURLå‘½ä»¤');
                
                // è‡ªåŠ¨æ»šåŠ¨åˆ°åŸºæœ¬ä¿¡æ¯åŒºåŸŸ
                document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
            } catch (error) {
                console.error('è§£æé”™è¯¯:', error);
                alert('è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®\n\næ”¯æŒæ ¼å¼ï¼š\n- URL: https://...\n- Headers: Key: Value\n- Body: {...}');
            }
        }

        // HTMLè½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // é¡µé¢å¸è½½æ—¶æ¸…ç©ºæ•æ„Ÿæ•°æ®ï¼ˆé¢å¤–å®‰å…¨æªæ–½ï¼‰
        window.addEventListener('beforeunload', function() {
            // æ¸…ç©ºæ‰€æœ‰è¾“å…¥å­—æ®µ
            document.getElementById('rawInput').value = '';
            document.getElementById('url').value = '';
            document.getElementById('body').value = '';
            const headers = document.querySelectorAll('.header-key, .header-value');
            headers.forEach(input => {
                if (input.value && !input.value.includes('Content-Type') && !input.value.includes('application/json')) {
                    input.value = '';
                }
            });
        });
    </script>
</body>
</html>

